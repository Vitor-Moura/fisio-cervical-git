<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>AcquaTec | Página Inicial</title>

    <script src="../assets/js/funcoes.js"></script>

    <link rel="icon" href="./assets/icon/favicon-fisio-cervical.png">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="dashboards.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">


    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body onload="validarSessao(),  obterDadosGrafico(1)">
    <div class="header">
        <div class="container">
            <a href="./index.html"><img src="api-projeto-site\public\assets\imgs\logo-fisio-cervical-white.png" alt="logotipo-fisio-cervical"
                    style="height: 50px;"></a>
            <ul class="navbar">
                <li>
                    <a href="./index.html">Home</a>
                </li>
                <li>
                    <a href="#como_exercitar">Como Exercitar</a>
                </li>
                <li>|</li>
                <li class="agora">Dashboard</li>
                <li>
                    <a href="./login.html">Login</a>
                </li>
                <li>
                    <a href="./cadastro.html">Cadastro</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="dashboard">
        <div class="container">
            <h2>Olá, <span id="b_usuario"></span>!</h2>
            <div class="perguntas">
                <div class="caixa_pergunta">
                    <h3>Qual o seu nivel de dor hoje?</h3>
                    <select id="lista_nivel_dor1" onchange="nivel_dor1()">
                        <option value="0">-- Escolha uma opção --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>
                <div class="caixa_pergunta">
                    <h3>Qual o seu nivel de dor depois do treino?</h3>
                    <select id="lista_nivel_dor2" onchange="nivel_dor2()">
                        <option value="0">-- Escolha uma opção --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>


            </div>

            <!-- Gráficos -->
            <div class="graficos_container">

                <!-- Gráfico de Linhas -->
                <div class="graph">
                    <canvas id="chartLine" style="width: 100%; height: 100%;"></canvas>
                </div>

                <!-- Gráfico de Barras -->
                <!-- <div class="graph">
            <canvas id="chartBar" style="width: 100%; height: 100%;"></canvas>
        </div> -->

                <!-- Grafico Pizza -->
                <!-- <div class="graph">
            <canvas id="chartPie" style="width: 100%; height: 100%;"></canvas>
        </div> -->
            </div>

        </div>

    </div>


    </div>


    <div class="footer">
        <div class="container">
            <h4>Created by Vitor Moura &copy; 2021</h4>
        </div>
    </div>
</body>
    <!-- <div class="janela">
        <div class="header-left">
            <h1>AcquaTec</h1> -->

            <!-- Manter -->
            <!-- <div class="hello">
                <h3>Olá, <span id="b_usuario"></span>!</h3>
            </div>

            <div class="btn-nav-white">
                <a href="./cards.html">
                    <h3>Aquários</h3>
                </a>
            </div>

            <div class="btn-nav">

                <h3>Gráficos</h3>

            </div>

            <div class="btn-nav-white">
                <a href="./mural.html">
                    <h3>Mural de Avisos</h3>
                </a>
            </div> -->

            <!-- Manter -->
            <!-- <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>

        <div class="dash">
            <div class="btns-dash"> -->
                <!-- O gráfico é chamado de acordo com o id (fk_aquario) do banco  -->
                <!-- <button class="btn-chart" onclick="obterDadosGrafico(1)">Aquario 1</button>
                <button class="btn-chart" onclick="obterDadosGrafico(2)">Aquario 2</button>
                <button class="btn-chart" onclick="obterDadosGrafico(3)">Aquario 3</button>
                <button class="btn-chart" onclick="obterDadosGrafico(4)">Aquario 4</button>
            </div>
            <div class="graph">
                <canvas id="canvas_grafico"></canvas>
            </div>
        </div>
    </div> -->


<!-- </body> -->

</html>

<script>
    var ax_nivel_dor1 = 0;
    var ax_nivel_dor2 = 0;
    var ax_lista_dor1 = [];
    var ax_lista_dor2 = [];


    function nivel_dor1() {
        ax_nivel_dor1 = lista_nivel_dor1.value;
        // adicionando os valores do select na lista
        var add_lista_dor = ax_lista_dor1.push(Number(ax_nivel_dor1));
        // inserindo o valor da lista no grafico e atualizando o grafico
        myChart.update();

        // if (ax_nivel_dor1 <= 5) {
        //     // window.location.href = './exercicios-a.html';
        //     window.open("./exercicios-a.html");
        // }
        // else {
        //     // window.location.href = './exercicios-b.html';
        //     window.open("./exercicios-b.html");
        // }
        lista_nivel_dor1.value = "0";
    }

    function nivel_dor2() {
        ax_nivel_dor2 = lista_nivel_dor2.value;
        // adicionando os valores do select na lista
        var add_lista_dor2 = ax_lista_dor2.push(Number(ax_nivel_dor2));
        // inserindo o valor da losta no grafico e atualizando o grafico
        myChart.update();

        // if (ax_nivel_dor2 <= 5) {
        //     // window.location.href = './exercicios-a.html';
        //     window.open("./exercicios-a.html");
        // }
        // else {
        //     // window.location.href = './exercicios-b.html';
        //     window.open("./exercicios-b.html");
        // }
        lista_nivel_dor2.value = "0";
    }


    // TESTANDO NOVO GRAFICO


    //Gráfico de Linha
    var ctx = document.getElementById('chartLine').getContext('2d');

    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
            datasets: [{
                label: 'Antes dos exercícios',
                data: ax_lista_dor1,
                backgroundColor: [
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089'
                ],

                borderColor: [
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089',
                    '#ff000089'
                ],
                borderWidth: 1
            },
            {
                label: 'Depois dos exercícios',
                data: ax_lista_dor2,
                backgroundColor: [
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8'
                ],

                borderColor: [
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8',
                    '#00c0e8'
                ],
                borderWidth: 2.5
            }

            ]
        },
        // gráfico Y começando do zero e termiando no 10 
        options: {
            plugins: {  // 'legend' now within object 'plugins {}'
                legend: {
                    labels: {
                        color: "white",
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10,
                    ticks: {
                        color: "white",
                    },
                    grid: {
                        color: "#ffffff4a",
                    }
                },
                x: {
                    ticks: {
                        color: "white",
                    },
                    grid: {
                        color: "#ffffff4a",
                    }
                }

            }
        }
    });


    // let proximaAtualizacao;

    //verificar_autenticacao();

    // altere aqui como os dados serão exibidos
    // e como são recuperados do BackEnd
    // function obterDadosGrafico(idAquario) {
    //     if (proximaAtualizacao != undefined) {
    //         clearTimeout(proximaAtualizacao);
    //     }

    //     fetch(`/medidas/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
    //         if (response.ok) {
    //             response.json().then(function (resposta) {
    //                 console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
    //                 resposta.reverse();

    //                 plotarGrafico(resposta, idAquario);
    //             });
    //         } else {
    //             console.error('Nenhum dado encontrado ou erro na API');
    //         }
    //     })
    //         .catch(function (error) {
    //             console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    //         });

    // }

    // só altere aqui se souber o que está fazendo!
    // function plotarGrafico(resposta, idAquario) {
    //     console.log('iniciando plotagem do gráfico...');

    //     var dados = {
    //         labels: [],
    //         datasets: [
    //             {
    //                 yAxisID: 'y-umidade',
    //                 label: 'Umidade',
    //                 borderColor: '#32B9CD',
    //                 backgroundColor: '#32b9cd8f',
    //                 fill: true,
    //                 data: []
    //             }
    //         ]
    //     };

    //     for (i = 0; i < resposta.length; i++) {
    //         var registro = resposta[i];
    //         dados.labels.push(registro.momento_grafico);
    //         dados.datasets[0].data.push(registro.umidade);
    //     }

    //     console.log(JSON.stringify(dados));

    //     var ctx = canvas_grafico.getContext('2d');
    //     window.grafico_linha = Chart.Line(ctx, {
    //         data: dados,
    //         //Configurações do gráfico
    //         options: {
    //             responsive: true,
    //             animation: { duration: 500 },
    //             hoverMode: 'index',
    //             stacked: false,
    //             title: {
    //                 display: true,
    //                 text: 'Histórico recente de umidade'
    //             },
    //             scales: {
    //                 yAxes: [{
    //                     type: 'linear',
    //                     display: true,
    //                     position: 'left',
    //                     id: 'y-temperatura',
    //                 }, {
    //                     type: 'linear',
    //                     display: true,
    //                     position: 'right',
    //                     id: 'y-umidade',

    //                     gridLines: {
    //                         drawOnChartArea: false,
    //                     },
    //                 }],
    //             }
    //         }
    //     });

        //Atualiza os dados de 2 em 2 segundos
    //     setTimeout(() => atualizarGrafico(idAquario, dados), 2000);
    // }

    // só mexer se quiser alterar o tempo de atualização
    // ou se souber o que está fazendo!
    // function atualizarGrafico(idAquario, dados) {
    //     fetch(`/medidas/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
    //         if (response.ok) {
    //             response.json().then(function (novoRegistro) {

    //                 console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
    //                 console.log(`Dados atuais do gráfico: ${dados}`);

    //                 // tirando e colocando valores no gráfico
    //                 dados.labels.shift(); // apagar o primeiro
    //                 dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento
    //                 dados.datasets[0].data.shift();  // apagar o primeiro de umidade
    //                 dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

    //                 window.grafico_linha.update();

    //                 proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados), 5000);
    //             });
    //         } else {
    //             console.error('Nenhum dado encontrado ou erro na API');
    //             proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados), 5000);
    //         }
    //     })
    //         .catch(function (error) {
    //             console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    //         });

    // }
</script>